# 📘 MCP Resources API 概要ドキュメント

## 概要
本ドキュメントは、Model Context Protocol (MCP) における **Resources API** の目的と構造をまとめた技術概要です。  
特に画像・音声・テキストなどのバイナリデータを安全かつ効率的に返却・参照するための設計基盤として利用します。

---

## 1. Resources API の目的

従来、MCP サーバーはツール出力としてテキストベースの結果（例：JSON・Base64文字列）を返していました。  
しかし、画像や音声などの大容量バイナリを直接返すと、以下の問題が発生します。

- Base64化によるサイズ膨張（約1.33倍）  
- 通信帯域・トークンコストの増加  
- 一部クライアントでのサイズ上限（約1MB）  

これを解消するために導入されたのが **Resources API** です。  
リソースは「URIで参照可能なデータ」として扱われ、必要なときにのみ取得されます。

---

## 2. 基本概念

| 要素 | 内容 |
|------|------|
| **Resource URI** | `file://`, `resource://`, `image://` などで識別される一意の参照先 |
| **Resource Metadata** | `mimeType`, `name`, `description` などの情報を含む |
| **resources/read** | URI を指定して実データを取得する標準メソッド |
| **resources/list** | 公開されている全リソースの一覧を返すメソッド |

MCP クライアント（Claude Code / Desktop など）はこの仕組みを理解し、  
必要なタイミングでデータを「オンデマンドで取得」します。

---

## 3. 利用フロー（概要）

1. **サーバー側**
   - 画像などの生成完了後、ローカルに保存（例：`./output`）  
   - そのファイルを **resource** として登録  
   - クライアントに `file://...` URI を返却

2. **クライアント側**
   - ツール実行結果の URI を受け取る  
   - `resources/read` コマンドで内容を取得  
   - MIME タイプをもとに表示または保存  

この設計により、生成結果をトークンや通信制約に左右されず扱えます。

---

## 4. MIME タイプとデータ構造

各リソースは以下のメタ情報を持ちます。

| フィールド | 例 | 説明 |
|-------------|----|------|
| `uri` | `file:///Users/.../output/image_123.png` | 一意のリソースURI |
| `name` | `"Generated Image"` | 表示名 |
| `mimeType` | `"image/png"` | コンテンツタイプ |
| `description` | `"AI生成画像"` | 任意の説明文 |
| `size` | `1204932` | バイト数（任意） |

MIME タイプは、クライアントが正しい表示・保存処理を行うために必須です。

---

## 5. 利用可能な URI スキーム例

| スキーム | 用途 | 補足 |
|-----------|------|------|
| `file://` | ローカルファイルへの直接参照 | Claude Desktopなどローカル環境で有効 |
| `resource://` | MCP専用リソース参照 | 内部API連携向け |
| `image://`, `audio://` | テンプレートURI | 動的生成・遅延取得向け |

> 推奨：ローカルMCPの場合は `file://` を標準スキームとする。

---

## 6. Resources の公開設計

MCP サーバー側では「リソースルート（base directory）」を定義します。  
例えば `./output` ディレクトリを公開したい場合：

- `/output` 以下の全ファイルを Resources として登録  
- URI は `file://` または `resource://` 形式で生成  
- クライアントは `resources/list` で一覧を取得可能  

> ルートはサンドボックス化し、外部ディレクトリへのアクセスを禁止することが望ましい。

---

## 7. セキュリティ・ガイドライン

- **公開範囲を限定**：`/output` など生成専用ディレクトリのみ対象  
- **一時ファイルのクリーンアップ**：古いリソースを定期削除  
- **パス検証**：ユーザー入力でパスを組み立てない  
- **ファイル型のMIME検証**：`image/png` / `image/jpeg` 等を厳密指定  

---

## 8. Base64 返却との併用戦略

| 利用シーン | 推奨返却方法 |
|-------------|---------------|
| プレビュー・アイコン | Base64 文字列（512px以内） |
| 本体データ | URI (`file://...`) で返却 |
| 非対応クライアント | 縮小版Base64をフォールバック返却 |

> Resources が使える環境では、Base64を主経路にしないこと。

---

## 9. テスト観点

| テスト項目 | 目的 |
|-------------|------|
| URI生成テスト | `file://` の構文が正しいか |
| `resources/read` 応答 | クライアントが正しくデータを取得できるか |
| MIME整合性 | MIMEと実データの一致を検証 |
| 削除・上書き挙動 | ファイル再生成時の挙動確認 |

---

## 10. 今後の拡張見込み

MCP コミュニティでは、以下の追加提案が進行中です。

- **バイナリストリーミングサポート**：逐次転送によるメモリ効率化  
- **署名付きURL発行**：安全なHTTPダウンロードリンク対応  
- **BlobResourceContents** の正式採用（Base64＋MIME統一構造）  

これらは Resources API との互換を保ちながら順次導入予定です。

---

## 結論

- **Resources API は「MCP版ファイルシステム」**  
- **URIベースでデータを共有し、必要時のみ読み込む構造**  
- **大容量画像・音声・動画などに最適な返却方式**  

本APIを利用することで、  
- 通信効率  
- 表示安定性  
- クライアント互換性  
がすべて向上します。

---

**最終更新:** 2025-10  
**作成者:** DigiCats 開発ガイドライン  
